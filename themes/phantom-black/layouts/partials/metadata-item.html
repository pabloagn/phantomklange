{{/*
Partial: Metadata Item
Displays a single label/value pair, optionally linked.
Context: A dict with:
    - label (string)
    - value (string)
    - link (string, optional): URL for the value
    - external (bool, optional): If true, adds target="_blank"
    - context (object, optional): The $ object, needed for GetPage checks
*/}}
{{ $value := .value }}
{{ $label := .label }}
{{ $link := .link | default "" }}
{{ $external := .external | default false }}
{{ $ := .context }}

{{ if $value }}
<div class="metadata-item">
    <div class="metadata-label">{{ $label }}</div>
    <div class="metadata-value">
        {{ if $link }}
            {{ $targetPage := "" }}
            {{ if and (not $external) $ }} {{/* Check if internal link and context exists */}}
                {{ $targetPage = $.Site.GetPage $link }}
            {{ end }}

            {{ if and $targetPage (not $external) }} {{/* Valid internal page found */}}
                 <a href="{{ $targetPage.RelPermalink }}" class="metadata-link">{{ $value }}</a>
            {{ else if $external }} {{/* External link */}}
                 <a href="{{ $link }}" class="metadata-link" target="_blank" rel="noopener noreferrer">{{ $value }}</a>
            {{ else if not $external }} {{/* Internal link but page not found, or just a taxonomy link */}}
                 <a href="{{ $link | relURL }}" class="metadata-link">{{ $value }}</a>
            {{ else }} {{/* Failsafe */}}
                {{ $value }}
            {{ end }}
        {{ else }}
            {{ $value }}
        {{ end }}
    </div>
</div>
{{ end }}